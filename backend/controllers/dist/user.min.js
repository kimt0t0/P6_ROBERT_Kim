"use strict";var bcrypt=require("bcrypt"),User=require("../models/User"),jwt=require("jsonwebtoken"),emailValidator=require("email-validator"),passwordValidator=require("password-validator"),MaskData=require("maskdata"),passwordSchema=new passwordValidator;passwordSchema.is().min(8).is().max(50).has().uppercase().has().lowercase().has().digits().has().not().symbols(),exports.signup=function(s,a,e){if(!emailValidator.validate(s.body.email)||!passwordSchema.validate(s.body.password))return a.status(400).json({message:"Veuillez vérifier le format de votre adresse e-mail ainsi que votre mot-de-passe. Il doit comporter minimum 8 caractères et contenir des minuscules, majuscules et chiffres. Les espaces et caractères spéciaux ne sont pas autorisés."});if(emailValidator.validate(s.body.email)||passwordSchema.validate(s.body.password)){var r=MaskData.maskEmail2(s.body.email);bcrypt.hash(s.body.password,10).then(function(s){new User({email:r,password:s}).save().then(function(s){return a.status(201).json({message:"Utilisateur créé!"})}).catch(function(s){return a.status(400).json({error:s})})}).catch(function(s){return a.status(500).json({error:s})})}},exports.login=function(s,e,a){var r=MaskData.maskEmail2(s.body.email);User.findOne({email:r}).then(function(a){if(!a)return e.status(401).json({error:"Utilisateur non trouvé!"});bcrypt.compare(s.body.password,a.password).then(function(s){if(!s)return e.status(401).json({error:"Mot de passe incorrect!"});e.status(200).json({userId:a._id,token:jwt.sign({userId:a._id},"RANDOM_TOKEN_SECRET",{expiresIn:"24h"})})}).catch(function(s){return e.status(500).json({error:s})})}).catch(function(s){return e.status(500).json({error:s})})};
//# sourceMappingURL=user.min.js.map
