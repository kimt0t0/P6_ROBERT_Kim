"use strict";var User=require("../models/User"),bcrypt=require("bcrypt"),jwt=require("jsonwebtoken"),emailValidator=require("email-validator"),passwordValidator=require("password-validator"),MaskData=require("maskdata"),passwordSchema=new passwordValidator;passwordSchema.is().min(8).is.max(50).has().uppercase().has().lowercase().has().digits().has().not().symbols().has().not().spaces(),exports.signup=function(s,e,a){if(!emailValidator.validate(s.body.email)||!passwordSchema.validate(s.body.password))return e.status(400).json({message:"Veuillez vérifier le format de votre adresse e-mail ainsi que votre mot-de-passe. Il doit comporter minimum 8 caractères et contenir des minuscules, majuscules et chiffres. Les espaces et caractères spéciaux ne sont pas autorisés."});if(emailValidator.validate(s.body.email)||passwordSchema.validate(s.body.password)){MaskData.maskEmail2(s.body.email);bcrypt.hash(s.body.password,10).then(function(s){new User({email:email,password:s}).save().then(function(s){return e.status(201).json({message:"Utilisateur créé!"})}).catch(function(s){return e.status(400).json({error:s})})}).catch(function(s){return e.status(500).json({error:s})})}},exports.login=function(s,a,e){User.findOne({email:s.body.email}).then(function(e){if(!e)return a.status(401).json({message:"Paire login/mot de passe incorrecte"});bcrypt.compare(s.body.password,e.password).then(function(s){if(!s)return a.status(401).json({message:"Paire login/mot de passe incorrecte"});a.status(200).json({userId:e._id,token:jwt.sign({userId:e._id},"RANDOM_TOKEN_SECRET",{expiresIn:"24h"})})}).catch(function(s){a.status(500).json({error:s})})}).catch(function(s){return a.status(500).json({error:s})})};
//# sourceMappingURL=user.min.js.map
