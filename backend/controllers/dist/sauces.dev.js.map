{"version":3,"sources":["sauces.js"],"names":["Sauce","require","fs","PasswordValidator","exports","createSauce","req","res","next","sauceObject","JSON","parse","body","sauce","_id","_userId","imageUrl","protocol","get","file","filename","save","then","status","json","message","error","modifySauce","updateOne","params","id","deleteSauce","findOne","split","unlink","deleteOne","getAllSauces","find","sauces","getOneSauce","likeSauce","like","$inc","likes","$push","usersLiked","userId","dislikes","usersDisliked","includes","$pull","console","log"],"mappings":"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","sourcesContent":["/* *** SAUCE CONTROLLER *** */\r\n\r\n/* VARIABLES */\r\nconst Sauce = require('../models/Sauce');\r\nconst fs = require('fs');\r\nconst PasswordValidator = require('password-validator');\r\n\r\n\r\n/* FONCTIONS */\r\n\r\n/* Create sauce: */\r\nexports.createSauce = (req, res, next) => {\r\n    const sauceObject = JSON.parse(req.body.sauce);\r\n\r\n    delete sauceObject._id;\r\n    delete sauceObject._userId;\r\n    \r\n    const sauce = new Sauce ({\r\n        ...sauceObject,\r\n        imageUrl: `${req.protocol}://${req.get('host')}/images/${req.file.filename}`,\r\n    });\r\n\r\n    sauce.save()\r\n\r\n    .then( () => {\r\n        res.status(201).json({message: 'Sauce saved'})\r\n    })\r\n    .catch(error => res.status(400).json({error}));\r\n};\r\n\r\n/* Modify sauce: */\r\nexports.modifySauce = (req, res, next) => {\r\n    const sauceObject = req.file ? {\r\n        ...JSON.parse(req.body.sauce),\r\n        imageUrl: `${req.protocol}://${req.get('host')}/images/${req.file.filename}`,\r\n    } : {...req.body};\r\n\r\n    Sauce.updateOne({_id: req.params.id}, {...sauceObject, _id: req.params.id})\r\n    .then(() => res.status(200).json({message: 'Object modified!'}))\r\n    .catch(error => res.status(401).json({error}));\r\n};\r\n\r\n/* Delete sauce: */\r\nexports.deleteSauce = (req, res, next) => {\r\n    Sauce.findOne({_id: req.params.id})\r\n    .then(sauce => {\r\n        const filename = sauce.imageUrl.split('/images')[1]; //récupération adresse image\r\n        fs.unlink(`images/${filename}`, () => { //suppression image du serveur\r\n        Sauce.deleteOne({_id: req.params.id})\r\n        .then(() => res.status(200).json({message: 'Sauce deleted!'}))\r\n        .catch(error => res.status(400).json({error}))\r\n    });\r\n    });\r\n };\r\n\r\n/* Get all sauces: */\r\nexports.getAllSauces = (req, res, next) => {\r\n    Sauce.find()\r\n    .then(sauces => res.status(200).json(sauces))\r\n    .catch(error => res.status(400).json({error}));\r\n};\r\n\r\n/* Get one sauce: */\r\nexports.getOneSauce = (req, res, next) => { \r\n    Sauce.findOne({_id: req.params.id})\r\n    .then(sauce => res.status(200).json(sauce))\r\n    .catch(error => res.status(400).json({error}));\r\n};\r\n\r\n /* Like sauce: */\r\nexports.likeSauce = (req, res, next) => {\r\n    const like = req.body.like;\r\n    //Add like:\r\n    if (like === 1) {\r\n        Sauce.updateOne({_id: req.params.id}, {\r\n            $inc: {likes: 1},\r\n            $push: {usersLiked: req.body.userId},\r\n            _id: req.params.id\r\n        })\r\n        .then(res.status(200).json({message: 'Like added :-)'}))\r\n        .catch(res.status(400).json({error}));\r\n    }\r\n    //Add dislike:\r\n    else if (like === -1) {\r\n        Sauce.updateOne({_id: req.params.id}, {\r\n            $inc: {dislikes: 1},\r\n            $push: {usersDisliked: req.body.userId},\r\n            _id: req.params.id\r\n        })\r\n        .then(res.status(200).json({message: 'Dislike added :-('}))\r\n        .catch(res.status(400).json({error}));\r\n    }\r\n\r\n\r\n    else {\r\n        Sauce.findOne({_id: req.params.id})\r\n        .then(sauce => {\r\n            if (sauce.usersLiked.includes(req.body.userId)) {\r\n                Sauce.updateOne({_id: req.params.id}, { //_id considéré comme \"undefined\" fait planter le code\r\n                    $inc: {likes: -1},\r\n                    $pull: {usersLiked: req.body.userId},\r\n                    _id: req.params.id\r\n                    })\r\n                    .then(res.status(200).json({message: \"You no longer like this sauce\"}))\r\n                    .catch(error => res.status(400).json({error}));\r\n            }\r\n            else if (sauce.usersDisliked.includes(req.body.userId)) {\r\n                Sauce.updateOne({_id: req.params.id}, {\r\n                    $inc: {dislikes: -1},\r\n                    $pull: {usersDisliked: req.body.userId},\r\n                    _id: req.params.id\r\n                    })\r\n                    .then(res.status(200).json({message: \"You no longer like this sauce\"}))\r\n                    .catch(error => res.status(400).json({error}));\r\n            }\r\n            else {console.log(\"There is a problem with this functionality\")}\r\n        })\r\n        .catch(error => res.status(400).json({error}));\r\n    }\r\n\r\n    /* \r\n    Si opinion === \"liked\"\r\n    Sauce.updateOne({_id: req.params.id}, {\r\n        $inc: {likes: -1},\r\n        $pull: {usersLiked: req.body.userId}\r\n        })\r\n        .then(res.status(200).json({message: \"You no longer like this sauce\"}))\r\n        .catch(error => res.status(400).json({error}));\r\n\r\n    \r\n    Si opinion === \"disliked\"\r\n    Sauce.updateOne({_id: req.params.id}, {\r\n        $inc: {dislikes: -1},\r\n        $pull: {usersDisliked: req.body.userId}\r\n        })\r\n        .then(res.status(200).json({message: \"You no longer like this sauce\"}))\r\n        .catch(error => res.status(400).json({error}));\r\n    */\r\n};"],"file":"sauces.dev.js"}