{"version":3,"sources":["sauces.js"],"names":["Sauce","require","fs","PasswordValidator","exports","createSauce","req","res","next","sauceObject","JSON","parse","body","sauce","_id","_userId","imageUrl","protocol","get","file","filename","save","then","status","json","message","error","getAllSauces","find","sauces","getOneSauce","findOne","params","id","modifySauce","updateOne","deleteSauce","split","unlink","deleteOne","likeSauce"],"mappings":"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","sourcesContent":["/* *** SAUCE CONTROLLER *** */\r\n\r\n/* VARIABLES */\r\nconst Sauce = require('../models/Sauce');\r\nconst fs = require('fs');\r\nconst PasswordValidator = require('password-validator');\r\n\r\n\r\n/* FONCTIONS */\r\n\r\n/* Create sauce: */\r\nexports.createSauce = (req, res, next) => {\r\n    const sauceObject = JSON.parse(req.body.sauce);\r\n\r\n    delete sauceObject._id;\r\n    delete sauceObject._userId;\r\n    \r\n    const sauce = new Sauce ({\r\n        ...sauceObject,\r\n        imageUrl: `${req.protocol}://${req.get('host')}/images/${req.file.filename}`,\r\n    });\r\n\r\n    sauce.save()\r\n\r\n    .then( () => {\r\n        res.status(201).json({message: 'Sauce saved'})\r\n    })\r\n    .catch(error => res.status(400).json({error}));\r\n};\r\n\r\n/* Get all sauces: */\r\nexports.getAllSauces = (req, res, next) => {\r\n    Sauce.find()\r\n    .then(sauces => res.status(200).json(sauces))\r\n    .catch(error => res.status(400).json({error}));\r\n};\r\n\r\n/* Get one sauce: */\r\nexports.getOneSauce = (req, res, next) => { \r\n    Sauce.findOne({_id: req.params.id})\r\n    .then(sauce => res.status(200).json(sauce))\r\n    .catch(error => res.status(400).json({error}));\r\n};\r\n\r\n/* Modify sauce: */\r\nexports.modifySauce = (req, res, next) => {\r\n    const sauceObject = req.file ? {\r\n        ...JSON.parse(req.body.sauce),\r\n        imageUrl: `${req.protocol}://${req.get('host')}/images/${req.file.filename}`\r\n    } : {...req.body};\r\n\r\n    Sauce.updateOne({_id: req.params.id}, {...sauceObject, _id: req.params.id})\r\n    .then(() => res.status(200).json({message: 'Object modified!'}))\r\n    .catch(error => res.status(401).json({error}));\r\n};\r\n\r\n/* Delete sauce: */\r\nexports.deleteSauce = (req, res, next) => {\r\n    Sauce.findOne({_id: req.params.id})\r\n    .then(sauce => {\r\n        const filename = sauce.imageUrl.split('/images')[1]; //récupération adresse image\r\n        fs.unlink(`images/${filename}`, () => { //suppression image du serveur\r\n        Sauce.deleteOne({_id: req.params.id})\r\n        .then(() => res.status(200).json({message: 'Sauce deleted!'}))\r\n        .catch(error => res.status(400).json({error}))\r\n    });\r\n    });\r\n };\r\n\r\n /* Like sauce: */\r\nexports.likeSauce = (req, res, next) => {\r\n    res.status(200).json({message: 'Objet liké !'});\r\n};"],"file":"sauces.dev.js"}