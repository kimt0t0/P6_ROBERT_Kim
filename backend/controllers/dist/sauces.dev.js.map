{"version":3,"sources":["sauces.js"],"names":["Sauce","require","fs","exports","getAllSauces","req","res","next","find","then","sauces","status","json","error","getOneSauce","findOne","_id","params","id","sauce","createSauce","sauceObject","JSON","parse","body","imageURL","protocol","get","file","filename","save","message","modifySauce","thing","imageUrl","_userId","userId","auth","updateOne","deleteSauce","split","unlink","deleteOne"],"mappings":"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","sourcesContent":["/* *** SAUCE CONTROLLER *** */\r\n\r\n/* VARIABLES */\r\nconst Sauce = require('../models/Sauce');\r\nconst fs = require('fs');\r\n\r\n\r\n/* FONCTIONS */\r\n\r\n/* Get all sauces: */\r\nexports.getAllSauces = (req, res, next) => {\r\n    Sauce.find()\r\n    .then((sauces) => res.status(200).json(sauces))\r\n    .catch(error => res.status(400).json({error}))\r\n};\r\n\r\n/* Get one sauce: */\r\nexports.getOneSauce = (req, res, next) => {\r\n    findOne({_id: req.params.id})\r\n    .then(sauce => res.status(200).json(sauce))\r\n    .catch(error => res.status(400).json({error}))\r\n};\r\n\r\n\r\n/* Create sauce: */\r\nexports.createSauce = (req, res, next) => {\r\n    const sauceObject = JSON.parse(req.body.sauce);\r\n    delete sauceObject._id;\r\n    //delete sauceObject._userId;\r\n    const sauce = new Sauce ({\r\n        ...sauceObject,\r\n        //userId: req.auth.userId,\r\n        imageURL: `${req.protocol}://${req.get('host')}/images/${req.file.filename}`,\r\n    });\r\n\r\n    sauce.save()\r\n\r\n    .then( () => {\r\n        res.status(201).json({message: 'Sauce saved'})\r\n    })\r\n    .catch(error => res.status(400).json({error}))\r\n};\r\n\r\n/* Modify sauce: */\r\nexports.modifySauce = (req, res, next) => {\r\n    const sauceObject = req.file ? {\r\n        ...JSON.parse(req.body.thing),\r\n        imageUrl: `${req.protocol}://${req.get('host')}/images/${req.file.filename}`\r\n    } : {...req.body};\r\n\r\n    delete sauceObject._userId;\r\n    Sauce.findOne({_id: req.params.id})\r\n        .then((sauce) => {\r\n            if (sauce.userId != req.auth.userId) {\r\n                res.status(401).json({message: 'Not authorized'});\r\n            }\r\n            else {\r\n                Sauce.updateOne({_id: req.params.id}, {...sauceObject, _id: req.params.id})\r\n                    .then(() => res.status(200).json({message: 'Object modified!'}))\r\n                    .catch(error => res.status(401).json({error}));\r\n            }\r\n        })\r\n        .catch(error => res.status(400).json({error}))\r\n};\r\n\r\n/* Delete sauce: */\r\nexports.deleteSauce = (req, res, next) => {\r\n    Sauce.findOne({ _id: req.params.id}) // utilisation de l'idée pour accéder à la sauce dans la bdd\r\n        .then(sauce => {\r\n            if (sauce.userId != req.auth.userId) { // vérification si utilisateur <-> créateur\r\n                res.status(401).json({message: 'Not authorized'});\r\n            } else {\r\n                const filename = thing.imageUrl.split('/images/')[1]; // récupération nom fichier dans url image\r\n                fs.unlink(`images/${filename}`, () => { //suppression du fichier et callback à exécuter ensuite\r\n                    Sauce.deleteOne({_id: req.params.id})\r\n                        .then(() => { res.status(200).json({message: 'Objet supprimé !'})})\r\n                        .catch(error => res.status(401).json({ error }));\r\n                });\r\n            }\r\n        })\r\n        .catch( error => res.status(500).json({ error }))\r\n };"],"file":"sauces.dev.js"}