{"version":3,"sources":["sauce.js"],"names":["Sauce","require","fs","exports","createSauce","req","res","next","sauceObject","JSON","parse","body","sauce","_id","_userId","userId","auth","imageURL","protocol","get","file","filename","save","then","status","json","message","error","console","log","modifySauce","thing","imageUrl","findOne","params","id","updateOne","deleteSauce","split","unlink","deleteOne"],"mappings":"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","sourcesContent":["/* *** SAUCE CONTROLLER *** */\r\n\r\n/* VARIABLES */\r\nconst Sauce = require('../models/Sauce');\r\nconst fs = require('fs');\r\n\r\n\r\n/* FONCTIONS */\r\n\r\n/* Create sauce: */\r\nexports.createSauce = (req, res, next) => {\r\n    const sauceObject = JSON.parse(req.body.sauce);\r\n    delete sauceObject._id;\r\n    delete sauceObject._userId;\r\n    const sauce = new Sauce ({\r\n        ...sauceObject,\r\n        userId: req.auth.userId,\r\n        imageURL: `${req.protocol}://${req.get('host')}/images/${req.file.filename}`,\r\n    });\r\n\r\n    sauce.save()\r\n\r\n    .then( () => {\r\n        res.status(201).json({message: 'Sauce saved'})\r\n    })\r\n    .catch( error => {\r\n        res.status(400).json({error})\r\n    })\r\n    console.log(sauce);\r\n};\r\n\r\n/* Modify sauce: */\r\nexports.modifySauce = (req, res, next) => {\r\n    const sauceObject = req.file ? {\r\n        ...JSON.parse(req.body.thing),\r\n        imageUrl: `${req.protocol}://${req.get('host')}/images/${req.file.filename}`\r\n    } : {...req.body};\r\n\r\n    delete sauceObject._userId;\r\n    Sauce.findOne({_id: req.params.id})\r\n        .then((sauce) => {\r\n            if (sauce.userId != req.auth.userId) {\r\n                res.status(401).json({message: 'Not authorized'});\r\n            }\r\n            else {\r\n                Sauce.updateOne({_id: req.params.id}, {...sauceObject, _id: req.params.id})\r\n                    .then(() => res.status(200).json({message: 'Object modified!'}))\r\n                    .catch(error => res.status(401).json({error}));\r\n            }\r\n        })\r\n        .catch(error => res.status(400).json({error}));\r\n};\r\n\r\n/* Delete sauce: */\r\nexports.deleteSauce = (req, res, next) => {\r\n    Sauce.findOne({ _id: req.params.id}) // utilisation de l'idée pour accéder à la sauce dans la bdd\r\n        .then(sauce => {\r\n            if (sauce.userId != req.auth.userId) { // vérification si utilisateur <-> créateur\r\n                res.status(401).json({message: 'Not authorized'});\r\n            } else {\r\n                const filename = thing.imageUrl.split('/images/')[1]; // récupération nom fichier dans url image\r\n                fs.unlink(`images/${filename}`, () => { //suppression du fichier et callback à exécuter ensuite\r\n                    Sauce.deleteOne({_id: req.params.id})\r\n                        .then(() => { res.status(200).json({message: 'Objet supprimé !'})})\r\n                        .catch(error => res.status(401).json({ error }));\r\n                });\r\n            }\r\n        })\r\n        .catch( error => {\r\n            res.status(500).json({ error });\r\n        });\r\n };"],"file":"sauce.dev.js"}